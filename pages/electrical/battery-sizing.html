<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Electrical — BearrSubstation</title>
  <link rel="preload" as="image" href="../../assets/images/bear-toggle.png"/>
  <link rel="preload" as="image" href="../../assets/images/logo.png"/>
  <link rel="stylesheet" href="../../assets/css/style.css?v=14"/>
</head>
<body>
<div class="wrap">
<header class="site-header" role="banner">
<div class="brand">
<a class="brand-link" href="../../index.html">
<img alt="BearrSubstation Logo" class="logo" src="../../assets/images/logo.png"/>
<span class="brand-title">BearrSubstation.com</span>
</a>
</div>
<button aria-controls="primary-nav" aria-expanded="false" aria-label="Open menu" class="hamburger" id="menuToggle">
<span></span><span></span><span></span>
</button>
<nav aria-label="Primary" class="site-nav" id="primary-nav" role="navigation"><a class="nav-link" href="../electrical.html">Electrical</a>
<a class="nav-link" href="../civil.html">Civil</a>
<a class="nav-link" href="../structural.html">Structural</a>
<a class="nav-link" href="../documents.html">Documents</a>
<a class="nav-link" href="../other.html">Other</a>
<a class="nav-link" href="../bonus.html">Bonus</a>
</nav>
<div class="header-actions">
<form aria-label="Search calculators" id="search-form" role="search">
<input aria-label="Search" id="search-input" placeholder="Search calculators &amp; tools…" type="search"/>
</form>
<button aria-label="Toggle theme" class="toggle" id="themeToggle">
<img alt="" src="../../assets/images/bear-toggle.png"/>
</button>
</div>
</header>

<main class="content" id="content" role="main">
  
  <section class="tool">
    <a class="back-link" href="../electrical.html">← Go back to Electrical Calculators</a>
    <h1>Battery Sizing (Substation DC)</h1>
    <p class="muted" style="max-width:70ch">
      Screen and size a DC station battery bank using a load profile and standard factors.
      <br/><strong>Method:</strong> Sum amp‑hour demand over the duty cycle and apply design, aging, and temperature factors.
      <br/><strong>Standards:</strong> IEEE Std 485 (Lead‑acid sizing), IEEE 1115 (Ni‑Cd), IEEE 1184 (Selection), NEC Article 480 (Storage batteries).
      Results are for preliminary sizing; confirm with manufacturer curves.
    </p>

    <form class="grid two" id="calc-form">
      <div>
        <label for="dcv">DC Bus Nominal Voltage (V)</label>
        <input id="dcv" type="number" step="1" value="125"/>
      </div>

      <div>
        <label for="contA">Continuous Load (A)</label>
        <input id="contA" type="number" step="0.1" value="10"/>
      </div>

      <div class="col-span-2">
        <label for="profile">Duty Cycle Loads (one per line)</label>
        <textarea id="profile" rows="6" placeholder="Current (A), Duration (min)
Example:
25, 5   # Trip & close burst
8, 60    # Relaying & comms"></textarea>
        <p class="form-note">Enter any number of steps. Lines can include comments after a #.</p>
      </div>

      <div>
        <label for="designMargin">Design Margin (%)</label>
        <input id="designMargin" type="number" step="1" value="10"/>
      </div>
      <div>
        <label for="aging">Aging Factor (%)</label>
        <input id="aging" type="number" step="1" value="25"/>
      </div>
      <div>
        <label for="temp">Temperature Factor (%)</label>
        <input id="temp" type="number" step="1" value="15"/>
      </div>
      <div>
        <label for="eff">Usable Capacity Fraction (0–1)</label>
        <input id="eff" type="number" step="0.05" value="0.8"/>
        <p class="form-note">Represents discharge rate/voltage & end-of-discharge effects. Use 0.8–0.9 for screening.</p>
      </div>
      <div>
        <label for="reserveMin">Reserve Duration for Continuous Load (min)</label>
        <input id="reserveMin" type="number" step="1" value="240"/>
        <p class="form-note">e.g., 4 hours (240 min) for station service without charger.</p>
      </div>
    </form>

    <div class="actions" style="margin-top:.75rem;">
      <button class="btn" id="calc-btn" type="button">Calculate</button>
      <button class="btn ghost" id="clear-btn" type="reset">Clear</button>
    </div>

    <div class="mt" id="result"></div>
  </section>
</main>

<script>
function parseProfile(text){
  const lines = (text||'').split(/\n+/);
  let steps = [];
  for (let ln of lines){
    ln = ln.replace(/#.*/, '').trim();
    if (!ln) continue;
    const parts = ln.split(',').map(s=>s.trim());
    if (parts.length >= 2){
      const I = parseFloat(parts[0]);
      const min = parseFloat(parts[1]);
      if (isFinite(I) && isFinite(min) && min>=0){
        steps.push({I, min});
      }
    }
  }
  return steps;
}

document.getElementById('calc-btn').addEventListener('click', function(){
  const Vdc = parseFloat(document.getElementById('dcv').value)||125;
  const Icont = parseFloat(document.getElementById('contA').value)||0;
  const reserveMin = Math.max(0, parseFloat(document.getElementById('reserveMin').value)||0);
  const steps = parseProfile(document.getElementById('profile').value);
  const dm = Math.max(0, parseFloat(document.getElementById('designMargin').value)||0)/100;
  const aging = Math.max(0, parseFloat(document.getElementById('aging').value)||0)/100;
  const temp = Math.max(0, parseFloat(document.getElementById('temp').value)||0)/100;
  const usable = Math.min(1, Math.max(0.3, parseFloat(document.getElementById('eff').value)||0.8));

  // Ah for continuous reserve
  const Ah_cont = Icont * (reserveMin/60);

  // Ah for duty cycle
  let Ah_steps = 0;
  for (const s of steps){
    Ah_steps += s.I * (s.min/60);
  }

  const Ah_raw = Ah_cont + Ah_steps;
  // Apply IEEE-style multipliers (design + aging + temp) as (1+m1)*(1+m2)*(1+m3)
  const factor = (1+dm)*(1+aging)*(1+temp);
  const Ah_corrected = Ah_raw * factor;

  // Adjust for usable fraction (end voltage/rate)
  const Ah_nameplate = Ah_corrected / usable;

  // Estimated energy (kWh)
  const kWh = (Ah_nameplate * Vdc) / 1000;

  document.getElementById('result').innerHTML = `
  <div class="card soft">
    <div class="kv">
      <div><span class="k">Duty-cycle Ah</span>&nbsp;<span class="v">${Ah_steps.toFixed(2)} Ah</span></div>
      <div><span class="k">Continuous reserve Ah</span>&nbsp;<span class="v">${Ah_cont.toFixed(2)} Ah</span></div>
      <div><span class="k">Total raw Ah</span>&nbsp;<span class="v">${Ah_raw.toFixed(2)} Ah</span></div>
      <div><span class="k">Correction factor</span>&nbsp;<span class="v">× ${factor.toFixed(3)}</span></div>
      <div><span class="k">Required nameplate</span>&nbsp;<span class="v">${Ah_nameplate.toFixed(1)} Ah</span></div>
      <div><span class="k">Approx bank energy</span>&nbsp;<span class="v">${kWh.toFixed(2)} kWh</span></div>
    </div>
    <details class="fold mt">
      <summary>Notes</summary>
      <ul class="mini">
        <li>Method aligns with <strong>IEEE 485</strong> (lead‑acid) concepts: profile Ah with factors for design margin, aging, and temperature.</li>
        <li>For nickel‑cadmium, see <strong>IEEE 1115</strong>; selection guidance in <strong>IEEE 1184</strong>.</li>
        <li>Set <em>Usable Capacity Fraction</em> to reflect discharge rate and end‑voltage (0.8–0.9 typical in screening).</li>
        <li>Finalize with manufacturer rating tables at the specified discharge time and temperature.</li>
      </ul>
    </details>
  </div>`;
});
</script>

<footer class="site-footer" role="contentinfo">
<div class="footer-inner">
<p>© <span id="year"></span> BearrSubstation.com</p>
<nav aria-label="Footer" class="footer-nav">
<a class="footer-link" href="contact.html">Contact us</a>
<a class="footer-link" href="privacy.html">Privacy</a>
<a class="footer-link" href="terms.html">Terms</a>
</nav>
</div>
</footer>
</div>
<script src="../../assets/js/main.js"></script>
<script defer src="../../assets/js/active-nav.js"></script>
</body>
</html>
